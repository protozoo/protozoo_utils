/*! protozoo_utils 2015-04-20 */
function List(){this.listSize=0,this.pos=0,this.dataStore=[],this.clear=clear,this.find=find,this.toString=toString,this.insert=insert,this.append=append,this.remove=remove,this.front=front,this.end=end,this.prev=prev,this.next=next,this.length=length,this.currPos=currPos,this.moveTo=moveTo,this.getElement=getElement,this.length=length,this.contains=contains,this.append=function(a){this.dataStore[this.listSize++]=a},this.find=function(a){for(var b=0;b<this.dataStore.length;++b)if(this.dataStore[b]==a)return b;return-1},this.remove=function(a){var b=this.find(a);return b>-1?(this.dataStore.splice(b,1),--this.listSize,!0):!1},this.length=function(){return this.listSize},this.toString=function(){return this.dataStore},this.insert=function(a,b){var c=this.find(b);return c>-1?(this.dataStore.splice(c+1,0,a),++this.listSize,!0):!1},this.clear=function(){delete this.dataStore,this.dataStore=[],this.listSize=this.pos=0},this.contains=function(a){for(var b=0;b<this.dataStore.length;++b)if(this.dataStore[b]==a)return!0;return!1},this.front=function(){this.pos=0},this.end=function(){this.pos=this.listSize-1},this.prev=function(){this.pos>0&&--this.pos},this.next=function(){this.pos<this.listSize-1&&++this.pos},this.currPos=function(){return this.pos},this.moveTo=function(a){this.pos=a},this.getElement=function(){return this.dataStore[this.pos]}}function Node(a){this.element=a,this.next=null,this.previous=null}function LList(a){a?this.circular=!0:this.circular=!1,this.head=new Node("head"),this.circular&&(this.head.next=this.head),this.find=find,this.insert=insert,this.display=display,this.remove=remove,this.findLast=findLast,this.dispReverse=dispReverse}function dispReverse(){var a=this.head;for(a=this.findLast();null!=a.previous;)print(a.element),a=a.previous}function findLast(){var a=this.head;if(!this.circular){for(;null!=a.next;)a=a.next;return a}for(;null!=a.next&&"head"!=a.next.element;)print(a.next.element),a=a.next}function remove(a){var b=this.find(a);null!=b.next&&(b.previous.next=b.next,b.next.previous=b.previous,b.next=null,b.previous=null)}function display(){for(var a=this.head;null!=a.next;)print(a.next.element),a=a.next}function find(a){for(var b=this.head;b.element!=a;)b=b.next;return b}function insert(a,b){var c=new Node(a),d=this.find(b);c.next=d.next,c.previous=d,d.next=c}function Queue(){function a(a){this.dataStore.push(a)}function b(){return this.dataStore.shift()}function c(){return this.dataStore[0]}function d(){return this.dataStore[this.dataStore.length-1]}function e(){for(var a="",b=0;b<this.dataStore.length;++b)a+=this.dataStore[b]+"\n";return a}function f(){return 0==this.dataStore.length?!0:!1}this.dataStore=[],this.enqueue=a,this.dequeue=b,this.front=c,this.back=d,this.toString=e,this.empty=f}function Stack(){function a(a){this.dataStore[this.top++]=a}function b(){return this.dataStore[--this.top]}function c(){return this.dataStore[this.top-1]}this.dataStore=[],this.top=0,this.push=a,this.pop=b,this.peek=c}!function(){var a=!1,b=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(){},Class.extend=function(c){function d(){!a&&this.init&&this.init.apply(this,arguments)}var e=this.prototype;a=!0;var f=new this;a=!1;for(var g in c)f[g]="function"==typeof c[g]&&"function"==typeof e[g]&&b.test(c[g])?function(a,b){return function(){var c=this._super;this._super=e[a];var d=b.apply(this,arguments);return this._super=c,d}}(g,c[g]):c[g];return d.prototype=f,d.prototype.constructor=d,d.extend=arguments.callee,d}}();var com=com||{};com.protozoo={math:{}},pz=window.com.protozoo,void 0==window.console&&(window.console={log:function(a){}}),pz.HashMap=Class.extend({init:function(){console.log("New HashMap created"),this.list=[],this.dictionary={}},addItem:function(a,b){return b||(b="id"),a[b]?this.dictionary[a[b]]?(console.info("Item with id '"+a[b]+"' already exists"),!1):(this.list.push(a),this.dictionary[a[b]]=a,!0):void console.info("Item doesn't include requested idAttribute '"+b+"' (by default will use 'id')")},getById:function(a){return this.dictionary[a]}}),pz.HashMap.fromArray=function(a,b){console.log("HashMap.fromArray() called"),b||(b="id");for(var c=new pz.HashMap,d=0;d<a.length;d++){var e=a[d];c.addItem(e,b)}return c},Array.zeroFilledArray=function(a){return new Array(a+1).join("0").split("")},Array.prototype.getRandom=function(){var a=this[Math.floor(Math.random()*this.length)];return a},Array.prototype.chunk=function(a){for(var b=[],c=0;c<this.length;c+=a)b.push(this.slice(c,c+a));return b},pz.layouts={},pz.layouts.oracle=function(a,b,c){var d=[],e=a.length,f=Math.radians(360/e),g=a[0]instanceof Array;if(g)for(var h=0;h<a.length;h++){for(var i=[],j=0;j<a[h].length;j++){var k={x:Math.cos(h*f)*(b+j*c),y:0,z:Math.sin(h*f)*(b+j*c)};i.push(k)}d.push(i)}else for(var h=0;h<a.length;h++){var k={x:Math.cos(h*f)*b,y:0,z:Math.sin(h*f)*b};d.push(k)}return d},pz.random={},pz.random.randomSpherePoint=function(a,b,c,d){var e=Math.random(),f=Math.random(),g=2*Math.PI*e,h=Math.acos(2*f-1),i=a+d*Math.sin(h)*Math.cos(g),j=b+d*Math.sin(h)*Math.sin(g),k=c+d*Math.cos(h);return{x:i,y:j,z:k}},pz.layouts.randomOnSphere=function(a,b){var c=[],d=a[0]instanceof Array;if(d)for(var e=0;e<a.length;e++){for(var f=[],g=0;g<a[e].length;g++){var h=pz.random.randomSpherePoint(0,0,0,b);f.push(h)}c.push(f)}else for(var g=0;g<a.length;g++){var h=pz.random.randomSpherePoint(0,0,0,b);c.push(h)}return c},pz.layouts.spiral3D=function(a,b,c){var d=[],e=(a.length,a[0]instanceof Array);if(e)for(var f=0;f<a.length;f++){for(var g=[],h=0;h<a[f].length;h++){var i={x:Math.cos(Math.radians(360*(a[f][h].normalDate.month()/12)))*(b+h*c),y:2*f,z:Math.sin(Math.radians(360*(a[f][h].normalDate.month()/12)))*(b+h*c)};g.push(i)}d.push(g)}else console.error("NOt yet implemented");return d},pz.math.map=function(a,b,c,d,e){var f=c+(e-a)*(d-c)/(b-a);return f},pz.math.radians=function(a){return a*Math.PI/180},pz.math.degrees=function(a){return 180*a/Math.PI},pz.math.areaToRadius=function(a){return 2*Math.sqrt(a/Math.PI)},pz.utils={setMultipleValuesFromObject:function(a,b){for(var c in b)a[c]=b[c]},CSVtoJSON:function(a,b){b=b||",","\n"!==a.substr(-1)&&(a+="\n");for(var c=new RegExp("(\\"+b+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+b+"\\r\\n]*))","gi"),d=[],e=null,f=[],g=[];e=c.exec(a);){var h=e[1],i=h.length&&h!=b;if(i){if(f.length){var j={};for(var k in g)j[f[k]]=g[k];d.push(j)}else f=g;g=[]}if(e[2])var l=e[2].replace(new RegExp('""',"g"),'"');else var l=e[3];g.push(l)}return d},countDistinct:function(a,b){var c={},d=[];if(b)for(var e=0;e<a.length;e++){var f=a[e],g=f[b];c[g]||(c[g]={count:0},c[g][b]=g,d.push(c[g])),c[g].count++}else{b="name";for(var e=0;e<a.length;e++){var f=a[e],g=f;c[g]||(c[g]={count:0},c[g][b]=g,d.push(c[g])),c[g].count++}}return d},groupBy:function(a,b){for(var c={},d=[],e=0;e<a.length;e++){var f=a[e],g=f[b];c[g]||(c[g]=[],d.push(c[g])),c[g].push(f)}return d},sortArray:function(a,b,c){c||(c="desc"),a.sort(function(a,d){return"asc"==c?a[b]<d[b]?-1:a[b]>d[b]?1:0:"desc"==c?a[b]>d[b]?-1:a[b]<d[b]?1:0:void console.error("direction must be 'asc' or 'desc'")})},concatenateProperty:function(a,b,c){for(var d="",e=0;e<a.length;e++){var f=a[e],g=f[b];d+=g+c}return d}},pz.three={},pz.three.createWorld=function(a,b,c,d){var e={};e.objects=[],e.clickHandler=b.clickHandler,e.mouseOverHandler=b.mouseOverHandler,e.mouseOutHandler=b.mouseOutHandler,e.mouseMoveHandler=b.mouseMoveHandler,e.mouseWheelHandler=b.mouseWheelHandler;var f=document.getElementById(a);if(!f)throw new Error({message:"Element with id="+a+" not found in document"});e.container=f;var g={fov:45,aspectRatio:window.innerWidth/window.innerHeight,near:.1,far:2e3,cameraBoundsX:[0,1e3],cameraBoundsY:[0,100]};for(var h in c)"type"!=h&&(g[h]=c[h]);c=g,e.cameraOptions=c;var i;if("perspective"!=c.type&&c.type)throw new Error({message:"Unable to create camera with type="+c.type});i=new THREE.PerspectiveCamera(g.fov,g.aspectRatio,g.near,g.far);var j=d3.scale.pow();j.domain([500,300]),j.range([0,1]);var k=d3.scale.pow();k.domain([window.innerWidth-200,window.innerWidth]),k.range([0,1]);var l=d3.scale.pow();l.domain([150,0]),l.range([0,1]);var m=d3.scale.pow();m.domain([window.innerHeight-150,window.innerHeight]),m.range([0,1]),i.update=function(){switch(i.interactionMode){case"horizontalScroll":var a=.95,b=10,c=.25;i.angularSpeedX||(i.angularSpeedX=0),i.angularSpeedY||(i.angularSpeedY=0);var d=j(window.mouseX),f=k(window.mouseX),g=l(window.mouseY),h=m(window.mouseY);d>1&&(d=0);var n,o,p=0,q=0;d>0?(p=d,n=-1):f>0&&(p=f,n=1),g>0?(q=g,o=-1):h>0&&(q=h,o=1);var r=Mathutils.map(e.cameraOptions.cameraBoundsY.min,e.cameraOptions.cameraBoundsY.max,.5,2,e.camera.position.y);p*=r,Math.abs(p)>0&&(i.angularSpeedX+=.1*p*n),Math.abs(q)>0&&(i.angularSpeedY+=.1*q*o),i.angularSpeedX*=a,i.angularSpeedY*=a,i.angularSpeedX>b&&(i.angularSpeedX=b),i.angularSpeedX<-b&&(i.angularSpeedX=-b),i.angularSpeedY>c&&(i.angularSpeedY=c),i.angularSpeedY<-c&&(i.angularSpeedY=-c),e.camera_pointer.position.x+=i.angularSpeedX,e.camera_pointer.position.z+=i.angularSpeedY,e.camera_pointer.position.z>0&&(e.camera_pointer.position.z=0),e.camera_pointer.position.z<-40&&(e.camera_pointer.position.z=-40),e.camera_pointer.position.x>e.cameraOptions.cameraBoundsX.max&&(e.camera_pointer.position.x=e.cameraOptions.cameraBoundsX.max),e.camera_pointer.position.x<e.cameraOptions.cameraBoundsX.min&&(e.camera_pointer.position.x=e.cameraOptions.cameraBoundsX.min),e.camera.position.x+=(e.camera_pointer.position.x-5-e.camera.position.x)/2,e.camera.position.z+=(e.camera_pointer.position.z+20-e.camera.position.z)/2;break;case"lockedPosition":}e.camera.lookAt(e.camera_pointer.position)},i.position.x=0,i.position.y=100,i.position.z=1e3,i.angularSpeedX=0,i.angularSpeedY=0,i.angularSpeedZ=0,i.interactionMode="horizontalScroll",i.setMode=function(a,b){switch(i.interactionMode=a,i.interactionModeOptions=b,i.interactionMode){case"horizontalScroll":break;case"lockedPosition":var c=10*Math.abs(b.position.x-e.camera_pointer.position.x),d=Math.min(3e3,c);e.pointerGoto(b.position.x,b.position.y,b.position.z-2,d),e.cameraGoto(b.position.x<e.camera_pointer.position.x?b.position.x-b.offset.x:b.position.x+b.offset.x,b.position.y+b.offset.y,b.position.z+b.offset.z,d)}},e.camera=i,e.camera.defaultPosition={x:0,y:100,z:-500},e.camera_pointer={defaultPosition:{x:0,y:0,z:0},position:{x:0,y:0,z:0}},e.cameraGoto=function(a,b,c,d,f){e.camera.animationMode=!0,e.camera.angularSpeedX=0,e.camera.angularSpeedY=0,d=d||1e3,$(e.camera.position).stop().animate({x:a||e.camera.position.x,y:b||e.camera.position.y,z:c||e.camera.position.z},d,"easeInOutCubic",function(){e.camera.animationMode=!1,f&&f()})},e.pointerGoto=function(a,b,c,d,f){e.camera.animationMode=!0,e.camera.angularSpeedX=0,e.camera.angularSpeedY=0,d=d||1e3,$(e.camera_pointer.position).stop().animate({x:a,y:b,z:c},d,"easeInOutCubic",function(){e.camera.animationMode=!1,f&&f()})},e.resetPointerPosition=function(){var a=e.camera_pointer;$(a.position).animate({x:a.defaultPosition.x,y:a.defaultPosition.y,z:a.defaultPosition.z},1e3,"easeInOutCubic")},e.resetCameraPosition=function(){var a=e.camera;$(a.position).animate({x:a.defaultPosition.x,y:a.defaultPosition.y,z:a.defaultPosition.z},1e3,"easeInOutCubic")},e.scene=new THREE.Scene,e.projector=new THREE.Projector,e.renderer=new THREE.WebGLRenderer,e.renderer.setClearColor(2104621),e.renderer.setSize(window.innerWidth,window.innerHeight),e.container.appendChild(e.renderer.domElement);var n=new THREE.DirectionalLight(16777215*Math.random());n.position.x=Math.random()-.5,n.position.y=Math.random()-.5,n.position.z=Math.random()-.5,n.position.normalize(),e.scene.add(n);var n=new THREE.DirectionalLight(16777215*Math.random());return n.position.x=Math.random()-.5,n.position.y=Math.random()-.5,n.position.z=Math.random()-.5,n.position.normalize(),e.scene.add(n),e.onMouseMove=function(a){window.mouseX=a.clientX,window.mouseY=a.clientY,e.mouseMoveHandler(a)},e.onWindowResize=function(){e.camera.left=window.innerWidth/-2,e.camera.right=window.innerWidth/2,e.camera.top=window.innerHeight/2,e.camera.bottom=window.innerHeight/-2,e.renderer.setSize(window.innerWidth,window.innerHeight),e.camera.aspect=window.innerWidth/window.innerHeight,e.camera.updateProjectionMatrix()},e.lastObjectUnderMouse=null,e.findObjectUnderMouse=function(a){a||(a={clientX:window.mouseX||0,clientY:window.mouseY||0});var b=new THREE.Vector3(a.clientX/window.innerWidth*2-1,2*-(a.clientY/window.innerHeight)+1,.5);e.projector.unprojectVector(b,e.camera);var c=new THREE.Raycaster(e.camera.position,b.sub(e.camera.position).normalize()),d=c.intersectObjects(e.objects);return d.length>0?d[0].object:null},e.onMouseDown=function(a){var b=e.findObjectUnderMouse(a);a.target.parentNode==e.container&&e.clickHandler(b)},e.onMouseWheel=function(a){a.preventDefault();var a=window.event||a,b=Math.max(-1,Math.min(1,a.wheelDelta||-a.detail));e.camera.position.y+=5*-b,console.log(" Wheel: ",b,e.camera.position.y,e.cameraOptions.cameraBoundsY),e.camera.position.y<e.cameraOptions.cameraBoundsY.min&&(e.camera.position.y=e.cameraOptions.cameraBoundsY.min),e.camera.position.y>e.cameraOptions.cameraBoundsY.max&&(e.camera.position.y=e.cameraOptions.cameraBoundsY.max),e.mouseWheelHandler(a)},window.addEventListener("resize",e.onWindowResize,!1),window.addEventListener("mousemove",e.onMouseMove,!1),document.addEventListener("mousedown",e.onMouseDown,!1),e.container.addEventListener("mousewheel",e.onMouseWheel,!1),document.addEventListener("DOMMouseScroll",e.onMouseWheel,!1),e.render=function(){e.camera.update(),e.renderer.render(e.scene,e.camera)},e.animate=function(){requestAnimationFrame(e.animate);e.findObjectUnderMouse();e.render()},e.addMesh=function(a,b,c,d){var f={color:b,shading:THREE.FlatShading,overdraw:.5};d&&(f.map=THREE.ImageUtils.loadTexture(d));var g=new THREE.MeshBasicMaterial(f),h=new THREE.Mesh(a,g);return c?"random"==c&&(c={x:1e3*Math.random()-500,y:1e3*Math.random()-500,z:1e3*Math.random()-500}):c={x:0,y:0,z:0},h.position.x=c.x,h.position.y=c.y,h.position.z=c.z,e.scene.add(h),e.objects.push(h),h},e.addPlane=function(a,b){var c={width:10,height:10,texture:null};pz.utils.setMultipleValuesFromObject(c,a);var d={side:THREE.DoubleSide};c.texture&&(d.map=THREE.ImageUtils.loadTexture(c.texture));var f=new THREE.MeshBasicMaterial(d);f.transparent=!0;var g=new THREE.PlaneGeometry(c.width,c.height),h=new THREE.Mesh(g,f);return h.position.x=b.x,h.position.y=b.y,h.position.z=b.z,e.scene.add(h),e.objects.push(h),h},e.addCube=function(a,b,c){var d={width:10,height:10,depth:10,widthSegments:1,heightSegments:1,depthSegments:1,texture:null};pz.utils.setMultipleValuesFromObject(d,a);var f=new THREE.BoxGeometry(d.width,d.height,d.depth,d.widthSegments,d.heightSegments,d.depthSegments),g=e.addMesh(f,b,c,d.texture);return g},e.addCylinder=function(a,b,c){var d={radiusTop:10,radiusBottom:10,height:10,radiusSegments:6,heightSegments:1,openEnded:!1};pz.utils.setMultipleValuesFromObject(d,a);var f=new THREE.CylinderGeometry(d.radiusTop,d.radiusBottom,d.height,d.radiusSegments,d.heightSegments,d.openEnded),g=e.addMesh(f,b,c);return g},e.addCurveLine=function(a,b,c,d){for(var f=100,g=b.x-a.x,h=b.y-a.y,i=Math.sqrt(g*g+h*h),j=new THREE.SplineCurve3([new THREE.Vector3(a.x,a.y,a.z),new THREE.Vector3(a.x+(b.x-a.x)/2,a.y+(b.y-a.y)/2+.3*i,a.z+(b.z-a.z)/2),new THREE.Vector3(b.x,b.y,b.z)]),k=new THREE.LineBasicMaterial({color:c,linewidth:d||1}),l=new THREE.Geometry,m=j.getPoints(f),n=0;n<m.length;n++)l.vertices.push(m[n]);var o=new THREE.Line(l,k);return e.scene.add(o),o},e.addLine=function(a,b,c,d){var f=b.x-a.x,g=b.y-a.y,h=(Math.sqrt(f*f+g*g),new THREE.LineBasicMaterial({color:c,linewidth:d||1})),i=new THREE.Geometry;i.vertices.push(a),i.vertices.push(b);var j=new THREE.Line(i,h);return e.scene.add(j),console.log("Line: ",j),j},e.animate(),e},window.visAngular=angular.module("d3BasicCharts",[]),angular.module("d3",[]).factory("d3Service",["$document","$q","$rootScope",function(a,b,c){function d(){c.$apply(function(){e.resolve(window.d3)})}log("d3Service");var e=b.defer(),f=a[0].createElement("script");f.type="text/javascript",f.async=!0,f.src="http://d3js.org/d3.v3.min.js",f.onreadystatechange=function(){"complete"==this.readyState&&d()},f.onload=d;var g=a[0].getElementsByTagName("body")[0];return g.appendChild(f),{d3:function(){return e.promise}}}]),visAngular.directive("horizontalBars",["d3Service",function(d3Service){return{restrict:"EA",scope:{},link:function(scope,element,attrs){console.log("d3Service 2",scope,element,attrs),d3Service.d3().then(function(d3){scope.onElementClick=function(a){console.log("element clicked: ",a),scope.elementClickHandler(a)};var margin=parseInt(attrs.margin)||20,barWidth=parseInt(attrs.barWidth)||20,barPadding=parseInt(attrs.barPadding)||5,valueProperty=attrs.valueProperty,fillColor=attrs.fillColor;scope.elementClickHandler=eval(attrs.elementClickHandler);try{dataset=eval(attrs.dataset)||[]}catch(e){return void console.log("no dataset at bars")}scope.dataset=dataset;var svg=d3.select(element[0]).append("svg").style("width","100%").style("height","100%");window.onresize=function(){scope.$apply()},scope.$watch(function(){return angular.element(window)[0].innerWidth},function(){scope.render()}),scope.render=function(){if(svg.selectAll("*").remove(),!scope.dataset)return void console.log("·LINK NOT scope.dataset");var a=d3.select(element[0]).node().offsetWidth,b=d3.select(element[0]).node().offsetHeight,c=d3.select(element[0]).node().offsetWidth-2*margin,d=d3.select(element[0]).node().offsetHeight-2*margin,e=d3.scale.linear().domain([0,d3.max(scope.dataset,function(a){return a[valueProperty]})]).range([0,d]),f=d3.scale.linear().domain([0,d3.max(scope.dataset,function(a){return a[valueProperty]})]).range([fillColor,fillColor]);svg.attr("height",b),svg.attr("width",a),barWidth=Math.max(2,(c-margin)/scope.dataset.length);{var g=svg.selectAll("g").data(scope.dataset).enter().append("g").on("click",function(a){scope.onElementClick(a)});g.append("rect").attr("height",1).attr("width",barWidth-barPadding).attr("class","horizontalBar").attr("x",function(a,b){return margin+b*(barWidth+barPadding)}).attr("y",d+margin).attr("fill",function(a){return f(a[valueProperty])}).transition().duration(1e3).attr("height",function(a){return e(a[valueProperty])}).attr("y",function(a){return margin+d-e(a[valueProperty])}),g.append("text").attr("class","caption2").attr("x",function(a,b){return margin+b*(barWidth+barPadding)}).attr("y",b-margin/2).text(function(a){var b=a.id;return b%5==0?b:null}),g.append("rect").attr("height",d).attr("fill","rgba(0,0,0,0)").attr("width",barWidth-barPadding).attr("x",function(a,b){return margin+b*(barWidth+barPadding)}).attr("y",margin).on("mouseover",function(){console.log(this.parentElement.children[0]),d3.select(this.parentElement.children[0]).transition().duration(100).attr("fill","white")}).on("mouseout",function(){d3.select(this.parentElement.children[0]).transition().duration(300).attr("fill",fillColor)})}}})}}}]),visAngular.directive("forceGraph",["d3Service",function(d3Service){return{restrict:"EA",scope:{},link:function(scope,element,attrs){console.log("forceGraph",scope,element,attrs),d3Service.d3().then(function(d3){var margin=parseInt(attrs.margin)||20,barWidth=parseInt(attrs.barWidth)||20,barPadding=parseInt(attrs.barPadding)||5,valueProperty=attrs.valueProperty,fillColor=attrs.fillColor,dataset=eval(attrs.dataset)||[],color=d3.scale.category20(),svg=d3.select(element[0]).append("svg").style("width","100%").style("height","100%");window.onresize=function(){scope.$apply()},scope.$watch(function(){return angular.element(window)[0].innerWidth},function(){scope.render()}),scope.render=function(){var a=d3.select(element[0]).node().offsetWidth,b=d3.select(element[0]).node().offsetHeight,c=d3.layout.force().charge(-20).linkDistance(20).size([a,b]),d=dataset;c.nodes(d.nodes).links(d.links).start();var e=svg.selectAll(".link").data(d.links).enter().append("line").attr("class","link").style("stroke-width",function(a){return 1}),f=svg.selectAll(".node").data(d.nodes).enter().append("circle").attr("class","node").attr("r",function(a){return"artist"==a.type?2+1*Math.sqrt(a.model.releases.length):2}).style("fill",function(a){return"artist"==a.type?"#fc0":fillColor}).on("mouseover",function(a){log("OVER: ",a.id,a)}).call(c.drag);f.append("title").text(function(a){return a.name}),c.on("tick",function(){e.attr("x1",function(a){return a.source.x}).attr("y1",function(a){return a.source.y}).attr("x2",function(a){return a.target.x}).attr("y2",function(a){return a.target.y}),f.attr("cx",function(a){return a.x}).attr("cy",function(a){return a.y})})}})}}}]);